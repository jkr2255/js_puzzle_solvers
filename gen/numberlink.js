!function t(e,n,r){function i(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n||t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){"use strict";function r(t,e){var n=[];if((e=+e)<0||e>t.length)return[];if(0==e)return[[]];if(1==e)return t.map(function(t){return[t]});if(e==t.length-1){var o=function(){var e=void 0;for(e=0;e<t.length;++e)n.push(t.filter(function(t,n){return n!==e}));return{v:n}}();if("object"===(void 0===o?"undefined":i(o)))return o.v}var a=[].concat(t);if(e==t.length)return[a];for(;;){if(a.length===e){n.push(a);break}var s=[a.pop()],u=r(a,e-1),f=void 0;for(f=0;f<u.length;++f)n.push(u[f].concat(s))}return n}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.exports=r},{}],2:[function(t,e,n){"use strict";e.exports="function"==typeof Worker&&"function"==typeof Int32Array},{}],3:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return Math.round(1e6*t)/1e6}var o;o=performance&&performance.now?function(){return performance.now()}:Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},e.exports=function(){function t(e){r(this,t),this.output=e}return t.prototype.start=function(){this.start_time=this.lap_time=o()},t.prototype.lap=function(t){var e=o();this.output(t+": "+i(e-this.lap_time)+" ms"),this.lap_time=e},t.prototype.finish=function(t){t&&this.lap(t),this.output("合計時間: "+i(this.lap_time-this.start_time)+" ms")},t}()},{}],4:[function(t,e,n){(function(t){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null;e.exports=function(){function t(e){var i=this;n(this,t),this.width=this.height=0,this.$field=r(e),this.values=[],this.$field.on("click.field","td",function(t){if(t.preventDefault(),!i.changeDisabled&&r.isFunction(i.changeFunc)){var e=t.target.dataset.pos.split("_"),n=e[0],o=e[1],a=i.getValue(n,o),s=i.changeFunc(a,!0,n,o);!1!==s&&i.setValue(n,o,s)}}),this.$field.on("contextmenu.field","td",function(t){if(t.preventDefault(),!i.changeDisabled&&r.isFunction(i.changeFunc)){var e=t.target.dataset.pos.split("_"),n=e[0],o=e[1],a=i.getValue(n,o),s=i.changeFunc(a,!1,n,o);!1!==s&&i.setValue(n,o,s)}})}return t.prototype.setSize=function(t,e){this.width=t,this.height=e,this.values=[],this.$field.empty();for(var n=0;n<e;++n){var i=r("<tr />");this.$field.append(i),this.values.push([]);for(var o=0;o<t;++o)r("<td />").attr("data-pos",o+"_"+n).appendTo(i),this.values[n].push("")}return this},t.prototype.setValue=function(t,e,n){return this.$field.find("td[data-pos='"+t+"_"+e+"']").text(n),this.values[e][t]=n,this},t.prototype.getValue=function(t,e){return this.values[e][t]},t.prototype.eachCell=function(t){for(var e=0;e<this.height;++e)for(var n=0;n<this.width;++n)if(!1===t(this.values[e][n],n,e))return!1;return!0},t}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){var e=[],n=void 0===t?"undefined":o(t);if("string"===n)e=t.split(" ");else if("number"===n)e=[t];else{if("[object Array]"!==a.call(t))throw new TypeError;e=t.slice()}for(var r=0;r<e.length;++r){var i=+e[r];if(e[r]=i,(0|i)!==i)throw new RangeError("Only integers are accepted for constraints.")}e.sort(function(t,e){return 0===t&&0===e?0:0===t?1:0===e?-1:Math.abs(t)-Math.abs(e)});for(var s=0,u=0;u<e.length;++u)if(s<Math.abs(e[u])&&(s=Math.abs(e[u])),u<e.length-1&&0!==e[u]&&e[u]+e[u+1]===0)return{text:"",maxVar:0};for(;0===e[e.length-1];)e.pop();return e.push(0),{text:e.join(" "),maxVar:s}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=Object.prototype.toString,s=function(){function t(){r(this,t),this.clear()}return t.prototype.clear=function(){this.textConstraints=[],this.maxVar=0},t.prototype.add=function(t){var e=i(t);return e.maxVar>0&&(this.textConstraints.push(e.text),this.maxVar<e.maxVar&&(this.maxVar=e.maxVar)),this},t.prototype.length=function(){return this.textConstraints.length},t.prototype.merge=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;++r){for(var i=0;i<e[r].textConstraints.length;++i)this.textConstraints.push(e[r].textConstraints[i]);this.maxVar<e[r].maxVar&&(this.maxVar=e[r].maxVar)}return this},t.prototype.toDIMACS=function(){return"p cnf "+this.maxVar+" "+this.textConstraints.length+"\n"+this.textConstraints.join("\n")},t.merge=function(){var e=new t;return e.merge.apply(e,arguments),e},t}();e.exports=s},{}],6:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=t("./sat_constraints"),o=function(){function t(){r(this,t)}return t.prototype.loadWorker=function(){this.worker=new Worker("gen/minisat_worker.js")},t.prototype.setListener=function(t){this.worker||this.loadWorker(),this.listener&&this.worker.removeEventListener("message",this.listener,!0),this.listener=function(e){var n=e.data.result,r=null,i="ERROR";n&&(i=(r=n.split(" ")).shift(),r=r.map(function(t){return+t})),t(i,r,e.data.stdout,e.data.stderr)},this.worker.addEventListener("message",this.listener,!0)},t.prototype.solve=function(t,e){var n=t.toDIMACS();this.setListener(e),this.worker.postMessage(n)},t.prototype.solve_loop=function(t,e){var n=this;this.setListener(function(r,o,a,s){var u=e(t,r,o,a,s);if(!1!==u){if(u instanceof i)return t=u,void n.worker.postMessage(u.toDIMACS());throw new TypeError}}),this.worker.postMessage(t.toDIMACS())},t}();e.exports=o},{"./sat_constraints":5}],7:[function(t,e,n){(function(e){"use strict";var n="undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null,r=t("./lib/puzzle_field"),i=t("./lib/environment_check"),o=t("./lib/lap_timer"),a=t("./lib/sat_constraints"),s=t("./lib/sat_solver"),u=t("./lib/combination");n(function(){if(i){var t=new r("#field"),e=[0],f=new s;f.loadWorker(),n("#make_field_btn").click(function(){var r=parseInt(n("#width").val(),10),i=parseInt(n("#height").val(),10);r>=2&&i>=2?(t.setSize(r,i),e=[0]):alert("2×2以上で設定してください。")}),n("#make_field_btn").click(),t.changeFunc=function(t,n){var r=+t;if(0!==r||n){var i=n?1:-1;for(e[r]-=1;r+=i,2===e[r]&&r>0;);return e[r]||(e[r]=0),e[r]+=1,r||""}};var c=n("#indicator"),l=new o(function(t){return n("<p />").text(t).appendTo(c)});n("#solve_btn").click(function(){function e(e,n,r){return(n*t.width+e)*o+r}function r(n,r,i){var o=[];return n>0&&o.push(e(n-1,r,i)),r>0&&o.push(e(n,r-1,i)),n<t.width-1&&o.push(e(n+1,r,i)),r<t.height-1&&o.push(e(n,r+1,i)),o}l.start();var i={},o=0;if(t.eachCell(function(t){(t=+t)&&(i[t]||(i[t]=0),i[t]+=1,o<t&&(o=t))}),0!==o){for(var s in i)if(2!==i[s])return void alert("数字は2つずつ入れてください。");l.lap("条件チェック");var c=new a,h=new a;t.eachCell(function(t,n,i){var a=+t;if(a){for(var s=r(n,i,a),f=1;f<=o;++f){var l=e(n,i,f);f!=a&&(l=-l),c.add(l)}c.add(s),u(s,2).forEach(function(t){return void c.add([-t[0],-t[1]])})}else!function(){var t=e(n,i,1),s=void 0,f=[];for(s=0;s<o;++s)f.push(t+s);for(u(f,2).forEach(function(t){return void c.add([-t[0],-t[1]])}),h.add(f),a=1;a<=o;++a){var l=r(n,i,a),p=u(l,3);switch(p.forEach(function(t){return void c.add([-t[0],-t[1],-t[2]])}),t=e(n,i,a),l.length){case 3:p=u(l,2);case 4:p.forEach(function(e){return void c.add([-t].concat(e))});break;case 2:c.add([-t,l[0]]),c.add([-t,l[1]])}}}()}),l.lap("立式");var p=c;n("#initial_kansai").is(":checked")||(p=a.merge(c,h)),f.solve(p,function(e,r,i,a){if(l.lap("初回ソルバー"),"SAT"===e){var s=r.filter(function(t){return t>0}),u=[],h=!1,p=void 0,d=void 0,v=void 0,y=void 0,w=void 0;for(s.length<t.width*t.height&&(alert("関西解です。"),h=!0),d=0;d<t.height;++d)u.push([]);for(v=0;v<s.length;++v)y=(s[v]-1)%o+1,d=Math.floor((s[v]-y)/o/t.width),p=(s[v]-y)/o-d*t.width,u[d][p]=y;var m={};for(m[3]="│",m[5]="┌",m[6]="└",m[9]="┐",m[10]="┘",m[12]="─",d=0,d=0;d<t.height;++d)for(p=0;p<t.width;++p)(y=u[d][p])?(w=0,p>0&&u[d][p-1]==y&&(w+=8),p<t.width-1&&u[d][p+1]==y&&(w+=4),d>0&&u[d-1][p]==y&&(w+=2),d<t.height-1&&u[d+1][p]==y&&(w+=1),m[w]&&t.setValue(p,d,m[w])):t.setValue(p,d,"");console.log(u),l.lap("出力"),h?l.finish():n("#bypass_unique").is(":checked")||(c.add(s.map(function(t){return-t})),f.solve(c,function(t,e,n,r){l.finish("別解チェック"),alert("SAT"===t?"別解があります。":"一意解です。")}))}else alert("解が見つかりませんでした。")})}else alert("数字が1つもないので終了します。")})}else alert("この環境ではJavaScriptの機能が不足していて、実行できません。")})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/combination":1,"./lib/environment_check":2,"./lib/lap_timer":3,"./lib/puzzle_field":4,"./lib/sat_constraints":5,"./lib/sat_solver":6}]},{},[7]);
